!function(){"use strict";function l(o,l,d,u){return new(d=d||Promise)(function(t,e){function n(o){try{i(u.next(o))}catch(o){e(o)}}function r(o){try{i(u.throw(o))}catch(o){e(o)}}function i(o){var e;o.done?t(o.value):((e=o.value)instanceof d?e:new d(function(o){o(e)})).then(n,r)}i((u=u.apply(o,l||[])).next())})}function d(o){return l(this,arguments,void 0,function*(e,o=7){for(var t=Date.now(),n={result:null,query_idx:0};null===n.result;){for(let o=0;o<e.length;o++){var r=document.querySelector(e[o]);if(r)return n.result=r,n.query_idx=o,n}if(yield new Promise(o=>setTimeout(o,100)),Date.now()-t>1e3*o)return console.error("wait_for_first_selector_that_exists: Timeout reached for queries: "+e),null}return n})}function u(o){return l(this,arguments,void 0,function*(o,e=7,t=null){let n=null;for(var r=Date.now();null===n;){var i=t||document;if(n=i.querySelector(o))return n;if(yield new Promise(o=>setTimeout(o,100)),Date.now()-r>1e3*e){console.warn("wait_for_selector_exists: Timeout reached for query: "+o);break}}return null})}function r(o){return l(this,arguments,void 0,function*(o,e=7,t=null){return yield n([o],e,t)})}function n(o){return l(this,arguments,void 0,function*(t,o=7,n=null){for(var r=Date.now();;){let e=!0;for(let o=0;o<t.length;o++)if((n||document).querySelector(t[o])){e=!1;break}if(e)return!0;if(yield new Promise(o=>setTimeout(o,100)),Date.now()-r>1e3*o){console.error("wait_for_selectors_stop_existing: Timeout reached for queries: "+t);break}}return!1})}function s(o,e){var t;o?(null!=(t=null==(t=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"value"))?void 0:t.set)&&t.call(o,e),o.dispatchEvent(new Event("input",{bubbles:!0}))):console.error("Input element not found.")}window._wait_for_selector_exists=u,window._wait_for_first_selector_that_exists=d,window._wait_for_selector_cease_existing=r,window._wait_for_selectors_stop_existing=n,window._set_input_value=s,window._find_selector_with_text_content=function(o,t){return l(this,void 0,void 0,function*(){var e=document.querySelectorAll(o);for(let o=0;o<e.length;o++)if(e[o].textContent===t)return e[o];return null})};const i="[data-test-id='portfolio-ticker-name']",e="[data-test-id='default-portfolio-tickers'] table",c="[data-test-id='holding-options-button']";const a="[data-test-id='modal-title']",f="[data-test-id='add-symbols-button']",t="[data-test-id='close-modal-button']",y="[data-test-id='modal-content'] input[data-test-id='search-input']",v="[data-test-id='result-list-title']",w="[data-test-id='help-label']",m="[data-test-id='symbol-search-result-item'] [data-test-id='item-name']",h="[data-test-id='ticker-name-label']",b="[data-test-id='add-ticker-done-btn']",p="[data-test-id='dropdown-option-delete']",g="[data-test-id='delete-symbol-button']",_="[data-test-id='dropdown-option-edit']",k="[data-test-id='modal-content'] button[type='submit']";function C(){return l(this,void 0,void 0,function*(){var o;return!(yield u(e))||0===(o=document.querySelectorAll(e)).length?null:o[o.length-1]})}function x(n){return l(this,void 0,void 0,function*(){var o=yield C();if(o)for(const t of o.querySelectorAll("tbody tr")){var e=t.querySelector(i);if(e&&e.textContent===n)return t}else console.log("No container found");return null})}function E(){return l(this,void 0,void 0,function*(){var o=yield C();if(!o)return console.log("No container found"),[];o=o.querySelectorAll("tbody tr");const r=[];return o.forEach(o=>{var e,t,n=null==(n=o.querySelector(i))?void 0:n.innerText;n?(t=o.querySelectorAll("td")).length<5?console.error("Not enough tds in row",t.length):(e=t[4].innerText,t=t[5].innerText,r.push({symbol:n,avg_open:parseFloat(t),units:parseFloat(e)})):console.log("No ticker name found in row",o)}),r})}function q(o,r){return l(this,void 0,void 0,function*(){let n={add:[],update:[],remove:[],unchanged:[]};function t(o,e,t){return o.toFixed(t)===e.toFixed(t)}return o.forEach(e=>{let t=!1;r.forEach(o=>{e.symbol===o.symbol&&(t=!0)}),t||n.add.push(e)}),o.forEach(e=>{r.forEach(o=>{e.symbol!==o.symbol||t(e.units,o.units,2)&&t(e.avg_open,o.avg_open,2)||(console.log("Found divergence in symbol",e.symbol,e,o),n.update.push(e))})}),r.forEach(e=>{let t=!1;o.forEach(o=>{o.symbol===e.symbol&&(t=!0)}),t||n.remove.push(e)}),o.forEach(e=>{r.forEach(o=>{e.symbol===o.symbol&&t(e.units,o.units,2)&&t(e.avg_open,o.avg_open,2)&&n.unchanged.push(o)})}),n})}const S=()=>l(void 0,void 0,void 0,function*(){var o;return!(yield u(a,3))||((o=yield u(t))&&o.click(),(o=yield r(a))||console.error("Could not close modal"),o)}),A=()=>l(void 0,void 0,void 0,function*(){var o=yield u(a,3);return!!o&&"Add Symbols to Follow"===o.innerText});function T(){return l(this,void 0,void 0,function*(){var o=yield u(b);return o&&!o.hasAttribute("disabled")?(o.click(),!!(yield r(a))||(console.error("Could not close modal"),!1)):yield S()})}function D(o){return l(this,arguments,void 0,function*(o,e=!0){if(!(yield function(){return l(this,void 0,void 0,function*(){var o;return!!(yield A())||(document.querySelector(f)?(document.querySelector(f).click(),(o=yield u(a))||console.error("Could not find modal title"),null!==o):(console.log("Could not find add symbol button"),!1))})}()))return console.error("Could not open add symbol modal"),!1;try{var t=yield u(y);if(!t)throw new Error("Could not find search input");s(t,o);var n=yield d([v,w+".text-red-85"]);if(null===n)throw new Error("Could not find search results");if(0===n.query_idx){var r=yield u(m);if(!r||r.textContent!==o)throw Error("Could not find searched symbol (query: "+o+", found: "+(null==r?void 0:r.textContent)+")");r.dispatchEvent(new KeyboardEvent("keydown",{bubbles:!0,cancelable:!0,key:"Enter",code:"Enter",keyCode:13,which:13}));var i=yield u(h);if(!i||i.innerText!==o)throw Error("Could not find added symbol");console.log("Added symbol "+o)}else if(1===n.query_idx)throw"No result matching '"+o+"' found"}catch(o){return console.error(o),!1}finally{e&&(yield T())}return!0})}const F=t=>l(void 0,void 0,void 0,function*(){var o=yield x(t.symbol);if(!o)return console.error("Could not find row with symbol",t.symbol),!1;var e=o.querySelector("[data-test-id='add-lot']");if(e)e.click();else{e=o.querySelector(c);if(!e)return console.error("Could not find dropdown opener for ticker "+t.symbol),!1;e.click(),console.debug("Opening dropdown");o=yield u(_,1);if(o||(console.debug("Opening dropdown again"),e.click()),!(o=yield u(_,1)))return console.error("Could not find edit lot button for ticker "+t.symbol),!1;console.debug("Clicking edit lot"),o.click(),console.debug("Edit lot modal opened")}e=yield u("input#share");if(!e)return console.error("Could not find shares input"),!1;s(e,t.units.toString());o=yield u("input#price");if(!o)return console.error("Could not find price input"),!1;s(o,t.avg_open.toString());e=yield u(k);return e&&e.click(),yield r(k),!0});function P(e){return l(this,void 0,void 0,function*(){for(const o of e)(yield D(o.symbol,!1))||console.warn("Could not add symbol "+o.symbol);return yield T()})}function N(e){return l(this,void 0,void 0,function*(){for(const o of e)(yield F(o))||console.warn("Could not edit symbol "+o.symbol);return!0})}function O(e){return l(this,void 0,void 0,function*(){for(const o of e)(yield function(n){return l(this,void 0,void 0,function*(){if((yield A())&&(yield S()),!(yield u(i)))return console.error("Could not find table"),!1;var o=yield x(n);if(!o)return console.error("Could not find row with symbol",n),!1;var e=null==o?void 0:o.querySelector(c);if(e){e.scrollIntoView(),console.log("Scrolled to dropdown opener"),e.click(),console.log("Clicked dropdown opener");var t=yield u(p,1);if(t||e.click(),!(t=yield u(p,1)))return console.error("Could not find delete lot button for ticker "+n),!1;if(t.click(),!(yield r(c,3,o)))return console.error("Could not close dropdown"),!1}e=yield u("button",7,o);if(!e)return console.error("Could not find delete button"),!1;e.scrollIntoView(),e.click();t=yield u(g);return t?(t.click(),yield r(g),!0):(console.error("Could not find modal delete button"),!1)})}(o.symbol))&&console.log("Removed symbol "+o.symbol)})}window._getSeekingAlphaPortfolio=E,window._getTickersAddUpdateRemove=q,window._doAddSymbol=D,window._doEditSymbol=F,window._find_symbol_row=x,window.doAll=function(e){return l(this,void 0,void 0,function*(){var o=yield E(),o=(console.log("Existing portfolio",o),yield q(e,o));console.log("Operations",o),console.log("removing",o.remove),yield O(o.remove),console.log("adding",o.add),yield P(o.add),console.log("updating just added items",o.update),yield N(o.add),console.log("updating existing items",o.update),yield N(o.update),console.log("done")})},window.doAddAll=P,window.doEditAll=N,window.doRemoveAll=O}();