var __awaiter=this&&this.__awaiter||function(o,a,l,u){return new(l=l||Promise)(function(t,e){function n(o){try{i(u.next(o))}catch(o){e(o)}}function r(o){try{i(u.throw(o))}catch(o){e(o)}}function i(o){var e;o.done?t(o.value):((e=o.value)instanceof l?e:new l(function(o){o(e)})).then(n,r)}i((u=u.apply(o,a||[])).next())})};const IGNORE=["NVTKL.L"],ETORO_TO_SA_MAPPING={"BA.L":{sa_name:"BAESY",conversion_rate:71.24/1384},"JD.US":{sa_name:"JD",conversion_rate:1},"RR.L":{sa_name:"RYCEY",conversion_rate:5.63/442.1358},"STLA.US":{sa_name:"STLA",conversion_rate:1},"VOW3.DE":{sa_name:"VWAGY",conversion_rate:15.08/120.72},JASMY:{sa_name:"JASMY-USD",conversion_rate:1}};function mapEtoroToSASymbol(o){return ETORO_TO_SA_MAPPING[o]}function getEtoroContainer(){return __awaiter(this,void 0,void 0,function*(){var o="et-portfolio-group-list";let e=null;for(;null===e||0==e.length;)e=document.getElementsByTagName(o),yield new Promise(o=>setTimeout(o,1e3));return console.log("Found etoro portoflio container with tag "+o),console.log(e[0]),e[0]})}function getEtoroPortfolio(){return __awaiter(this,void 0,void 0,function*(){console.log("Requesting etoro portfolio");var o=(yield getEtoroContainer()).querySelectorAll('[automation-id="watchlist-grid-instruments-list"]');const i=[];return o.forEach(e=>{var t=null==(t=e.querySelector('[automation-id="portfolio-overview-table-body-cell-avg-open-rate"]'))?void 0:t.innerText;let n=null==(r=e.querySelector('[automation-id="portfolio-overview-table-body-cell-market-name"]'))?void 0:r.innerText;e=null==(r=e.querySelector('[automation-id="portfolio-overview-table-body-cell-units-value"]'))?void 0:r.innerText;if(e&&t&&n){let o=parseFloat(t);var r=parseFloat(e);IGNORE.includes(n)||((t=mapEtoroToSASymbol(n))&&(n=t.sa_name,o*=t.conversion_rate),i.push({avg_open:o,symbol:n,units:r}))}}),i.filter(o=>!!o.units)})}window.getEtoroPortfolio=getEtoroPortfolio;